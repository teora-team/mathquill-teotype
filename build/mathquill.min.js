/**
 * MathQuill v0.10.3, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
!function(){function t(){}function e(t){var e=t.length-1;return function(){var n=m.call(arguments,0,e),s=m.call(arguments,e);return t.apply(this,n.concat([s]))}}function n(t){return e(function(e,n){"function"!=typeof e&&(e=g(e));var s=function(t){return e.apply(t,[t].concat(n))};return t.call(this,s)})}function s(t){var e=m.call(arguments,1);return function(){return t.apply(this,e)}}function i(t,e){if(!e)throw new Error("prayer failed: "+t)}function r(t){i("a direction was passed",t===b||t===x)}function a(t,e,n){i("a parent is always present",t),i("leftward is properly set up",function(){return e?e[x]===n&&e.parent===t:t.ends[b]===n}()),i("rightward is properly set up",function(){return n?n[b]===e&&n.parent===t:t.ends[x]===e}())}function o(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function l(t){return o(),oe(t)}function c(e){function n(t){var e,n;return t&&t.nodeType?(e=v(t).children(".mq-root-block").attr(ue),n=e&&k.byId[e].controller,n?i[n.KIND_OF_MQ](n):null):null}function s(t,e){var n,s,r;e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:i});for(n in e)e.hasOwnProperty(n)&&(s=e[n],r=_[n],t[n]=r?r(s):s)}var i,r,a;if(!(A<=e&&e<=R))throw"Only interface versions between "+A+" and "+R+" supported. You specified: "+e;i={},n.L=b,n.R=x,n.saneKeyboardEvents=I,n.config=function(t){return s(C.p,t),this},n.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";E[t]=e},r=i.AbstractMathQuill=q(D,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e,n=this.__controller,s=n.root,i=n.container;n.createTextarea(),e=i.addClass(t).contents().detach(),s.jQ=v('<span class="mq-root-block"/>').attr(ue,s.id).appendTo(i),this.latex(e.text()),this.revert=function(){return i.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},t.config=function(t){return s(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),n.prototype=r.prototype,i.EditableField=q(r,function(e,n){e.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.empty=function(){var t=this.__controller.root,e=this.__controller.cursor;return t.eachChild("postOrder","dispose"),t.ends[b]=t.ends[x]=0,t.jQ.empty(),delete e.selection,e.insAtRightEnd(t),this},e.cmd=function(t){var e,n=this.__controller.notify(),s=n.cursor;return/^\\[a-z]+$/i.test(t)?(t=t.slice(1),(e=O[t]||se[t])&&(t=e(t),s.selection&&t.replaces(s.replaceSelection()),t.createLeftOf(s.show()),this.__controller.scrollHoriz())):s.parent.write(s,t),n.blurred&&s.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[b];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(b)},e.moveToRightEnd=function(){return this.moveToDirEnd(x)},e.keystroke=function(e){var n;for(e=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n+=1)this.__controller.keystroke(e[n],{preventDefault:t});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},e.dropEmbedded=function(t,e,n){var s,i=t-v(window).scrollLeft(),r=e-v(window).scrollTop(),a=document.elementFromPoint(i,r);this.__controller.seek(v(a),t,e),s=ne().setOptions(n),s.createLeftOf(this.__controller.cursor)},e.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var s=this.__controller,i=s.root;return ce.contains(i.jQ[0],n)||(n=i.jQ[0]),s.seek(v(n),t+pageXOffset,e+pageYOffset),s.blurred&&this.focus(),this},e.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}),n.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},n.EditableField.prototype=i.EditableField.prototype;for(a in L)!function(t,s){var r=i[t]=s(i);n[t]=function(s,i){var a,o=n(s);return o instanceof r||!s||!s.nodeType?o:(a=Q(r.RootBlock(),v(s),C()),a.KIND_OF_MQ=t,r(a).__mathquillify(i,e))},n[t].prototype=r.prototype}(a,L[a]);return n}function h(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(e=0;e<n.length;e+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(n[e]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function u(t,e,n){return q(H,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function p(t){var e=this.parent,n=t;do{if(n[x])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function f(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));pt(this.delimjQs,pe(1+.2*(t-1),1.2),1.2*t)}}function d(t,e){var e=e||t,n=te[t],i=te[e];T[t]=s(Jt,b,t,n,e,i),T[n]=s(Jt,x,t,n,e,i)}var m,g,q,b,x,v,w,k,y,O,T,S,j,Q,L,C,_,D,E,A,R,B,I,z,M,F,$,N,P,V,W,U,H,K,G,Y,X,Z,J,tt,et,nt,st,it,rt,at,ot,lt,ct,ht,ut,pt,ft,dt,mt,gt,qt,bt,xt,vt,wt,kt,yt,Ot,Tt,St,jt,Qt,Lt,Ct,_t,Dt,Et,At,Rt,Bt,It,zt,Mt,Ft,$t,Nt,Pt,Vt,Wt,Ut,Ht,Kt,Gt,Yt,Xt,Zt,Jt,te,ee,ne,se,ie,re,ae,oe,le,ce="function"==typeof require?require("jquery"):window.jQuery,he="mathquill-command-id",ue="mathquill-block-id",pe=Math.min,fe=Math.max;if(!ce)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";m=[].slice,g=e(function(t,n){return e(function(e,s){if(t in e)return e[t].apply(e,n.concat(s))})}),q=function(t,e,n){function s(t){return"object"==typeof t}function i(t){return"function"==typeof t}function r(){}return function t(n,a){function o(){var t=new l;return i(t.init)&&t.init.apply(t,arguments),t}function l(){}var c,h,u;return void 0===a&&(a=n,n=Object),o.Bare=l,c=r.prototype=n.prototype,h=l.prototype=o.prototype=o.p=new r,h.constructor=o,o.extend=function(e){return t(o,e)},(o.open=function(t){if(u={},i(t)?u=t.call(o,h,c,o,n):s(t)&&(u=t),s(u))for(var r in u)e.call(u,r)&&(h[r]=u[r]);return i(h.init)||(h.init=n),o})(a)}}(0,{}.hasOwnProperty),b=-1,x=1,v=q(ce,function(t){t.insDirOf=function(t,e){return t===b?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===b?this.prependTo(e):this.appendTo(e)}}),w=q(function(t){t.parent=0,t[b]=0,t[x]=0,t.init=function(t,e,n){this.parent=t,this[b]=e,this[x]=n},this.copy=function(t){return w(t.parent,t[b],t[x])}}),k=q(function(t){function e(){return s+=1}t[b]=0,t[x]=0,t.parent=0;var s=0;this.byId={},t.init=function(){this.id=e(),k.byId[this.id]=this,this.ends={},this.ends[b]=0,this.ends[x]=0},t.dispose=function(){delete k.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=v(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){var n,s;for(t.getAttribute&&(n=t.getAttribute("mathquill-command-id"),s=t.getAttribute("mathquill-block-id"),n&&k.byId[n].jQadd(t),s&&k.byId[s].jQadd(t)),t=t.firstChild;t;t=t.nextSibling)e(t)}var n;for(t=v(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){r(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[b],e[x]),n},t.createLeftOf=function(t){return this.createDir(b,t)},t.selectChildren=function(t,e){return j(t,e)},t.bubble=n(function(t){var e;for(e=this;e&&!1!==t(e);e=e.parent);return this}),t.postOrder=n(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[b]&&0===this.ends[x]},t.isStyleBlock=function(){return!1},t.children=function(){return y(this.ends[b],this.ends[x])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,s){return y(this,this).withDirAdopt(t,e,n,s),this},t.adopt=function(t,e,n){return y(this,this).adopt(t,e,n),this},t.disown=function(){return y(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),y=q(function(t){t.init=function(t,e,n){if(void 0===n&&(n=b),r(n),i("no half-empty fragments",!t==!e),this.ends={},t){i("withDir is passed to Fragment",t instanceof k),i("oppDir is passed to Fragment",e instanceof k),i("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var s=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(s)}},t.jQ=v(),t.withDirAdopt=function(t,e,n,s){return t===b?this.adopt(e,n,s):this.adopt(e,s,n)},t.adopt=function(t,e,n){var s,i,r;return a(t,e,n),s=this,s.disowned=!1,(i=s.ends[b])?(r=s.ends[x],e||(t.ends[b]=i),n?n[b]=r:t.ends[x]=r,s.ends[x][x]=n,s.each(function(n){n[b]=e,n.parent=t,e&&(e[x]=n),e=n}),s):this},t.disown=function(){var t,e,n=this,s=n.ends[b];return!s||n.disowned?n:(n.disowned=!0,t=n.ends[x],e=s.parent,a(e,s[b],s),a(e,t,t[x]),s[b]?s[b][x]=t[x]:e.ends[b]=t[x],t[x]?t[x][b]=s[b]:e.ends[x]=s[b],n)},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=n(function(t){var e=this,n=e.ends[b];if(!n)return e;for(;n!==e.ends[x][x]&&!1!==t(n);n=n[x]);return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),O={},T={},S=q(w,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=v('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[x]?this.selection&&this.selection.ends[b][b]===this[b]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[x].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=v(),this},t.withDirInsertAt=function(t,e,n,s){var i=this.parent;this.parent=e,this[t]=n,this[-t]=s,i!==e&&i.blur&&i.blur(this)},t.insDirOf=function(t,e){return r(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(b,t)},t.insRightOf=function(t){return this.insDirOf(x,t)},t.insAtDirEnd=function(t,e){return r(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(b,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(x,t)},t.jumpUpDown=function(t,e){var n,s,i=this;i.upDownCache[t.id]=w.copy(i),n=i.upDownCache[e.id],n?n[x]?i.insLeftOf(n[x]):i.insAtRightEnd(n.parent):(s=i.offset().left,e.seek(s,i))},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[x],s=this,i=t[b];if(t.disown().eachChild(function(s){s.isEmpty()||(s.children().adopt(e,i,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),i=s.ends[x])}),!this[x])if(this[b])this[x]=this[b][x];else for(;!this[x];){if(this.parent=this.parent[x],!this.parent){this[x]=t[x],this.parent=e;break}this[x]=this.parent.ends[b]}this[x]?this.insLeftOf(this[x]):this.insAtRightEnd(e),t.jQ.remove(),t[b].siblingDeleted&&t[b].siblingDeleted(s.options,x),t[x].siblingDeleted&&t[x].siblingDeleted(s.options,b)},t.startSelection=function(){var t,e=this.anticursor=w.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,s,r,a,o,l=this.anticursor;if(this[b]===l[b]&&this.parent===l.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in l.ancestors){e=t.parent;break}if(i("cursor and anticursor in the same tree",e),n=l.ancestors[e.id],a=x,t[b]!==n)for(o=t;o;o=o[x])if(o[x]===n[x]){a=b,s=t,r=n;break}return a===x&&(s=n,r=t),s instanceof w&&(s=s[x]),r instanceof w&&(r=r[b]),this.hide().selection=e.selectChildren(s,r),this.insDirOf(a,this.selection.ends[a]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[b]=this.selection.ends[b][b],this[x]=this.selection.ends[x][x],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[b]=t.ends[b][b],this[x]=t.ends[x][x],delete this.selection),t}}),j=q(y,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),Q=q(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=S(t,n)},t.handle=function(t,e){var n,s=this.options.handlers;s&&s.fns[t]&&(n=s.APIClasses[this.KIND_OF_MQ](this),e===b||e===x?s.fns[t](e,n):s.fns[t](n))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),L={},C=q(),_={},D=q(),E={},l.prototype=D.p,l.VERSION="v0.10.3",l.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return o=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},o(),l},l.getInterface=c,A=c.MIN=1,R=c.MAX=2,l.noConflict=function(){return window.MathQuill=B,l},B=window.MathQuill,window.MathQuill=l,I=function(){function e(t){var e,s=t.which||t.keyCode,i=n[s],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=i||String.fromCharCode(s),r.length||i?(r.push(e),r.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,s){function i(t){k=t,clearTimeout(g),g=setTimeout(t)}function r(e){i(function(n){k=t,clearTimeout(g),e(n)})}function a(e){k(),k=t,clearTimeout(g),v.val(e),e&&v[0].select&&v[0].select(),q=!!e}function o(){var t=v[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function l(){s.keystroke(e(b),b)}function c(t){b=t,x=null,q&&r(function(t){t&&"focusout"===t.type||!v[0].select||v[0].select()}),l()}function h(t){b&&x&&l(),x=t,i(p)}function u(t){b&&!x&&i(p)}function p(){if(!o()){var t=v.val();1===t.length?(v.val(""),s.typedText(t)):t&&v[0].select&&v[0].select()}}function f(){b=x=null}function d(t){v.focus(),i(m)}function m(){var t=v.val();v.val(""),t&&s.paste(t)}var g,q,b=null,x=null,v=ce(n),w=ce(s.container||v),k=t;return w.bind("keydown keypress input keyup focusout paste",function(t){k(t)}),q=!1,w.bind({keydown:c,keypress:h,keyup:u,focusout:f,cut:function(){r(function(){s.cut()})},copy:function(){r(function(){s.copy()})},paste:d}),{select:a}}}(),z=q(function(t,e,n){function s(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}var r,a,o;t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(o)._(""+t,e,s)},t.or=function(t){i("or is passed a parser",t instanceof n);var e=this;return n(function(n,s,i){function r(e){return t._(n,s,i)}return e._(n,s,r)})},t.then=function(t){var e=this;return n(function(s,r,a){function o(e,s){var o=t instanceof n?t:t(s);return i("a parser is returned",o instanceof n),o._(e,r,a)}return e._(s,o,a)})},t.many=function(){var t=this;return n(function(e,n,s){function i(t,n){return e=t,a.push(n),!0}function r(){return!1}for(var a=[];t._(e,i,r););return n(e,a)})},t.times=function(t,e){arguments.length<2&&(e=t);var s=this;return n(function(n,i,r){function a(t,e){return u.push(e),n=t,!0}function o(t,e){return c=e,n=t,!1}function l(t,e){return!1}var c,h,u=[],p=!0;for(h=0;h<t;h+=1)if(!(p=s._(n,a,o)))return r(n,c);for(;h<e&&p;h+=1)p=s._(n,a,l);return i(n,u)})},t.result=function(t){return this.then(a(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return a(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},this.string=function(t){var e=t.length,s="expected '"+t+"'";return n(function(n,i,r){var a=n.slice(0,e);return a===t?i(n.slice(e),a):r(n,s)})},r=this.regex=function(t){i("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,s,i){var r,a=t.exec(n);return a?(r=a[0],s(n.slice(r.length),r)):i(n,e)})},a=n.succeed=function(t){return n(function(e,n){return n(e,t)})},n.fail=function(t){return n(function(e,n,s){return s(e,t)})},n.letter=r(/^[a-z]/i),n.letters=r(/^[a-z]*/i),n.digit=r(/^[0-9]/),n.digits=r(/^[0-9]*/),n.whitespace=r(/^\s+/),n.optWhitespace=r(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),o=n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),Q.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),r.selection&&r.selection.jQ.addClass("mq-blur"),e()}function e(){r.hide().parent.blur(),s.container.removeClass("mq-focused"),v(window).unbind("blur",t)}var n,s=this,i=s.root,r=s.cursor;s.textarea.focus(function(){s.blurred=!1,clearTimeout(n),s.container.addClass("mq-focused"),r.parent||r.insAtRightEnd(i),r.selection?(r.selection.jQ.removeClass("mq-blur"),s.selectionChanged()):r.show()}).blur(function(){s.blurred=!0,n=setTimeout(function(){i.postOrder("intentionalBlur"),r.clearSelection().endSelection(),e()}),v(window).bind("blur",t)}),s.blurred=!0,r.hide().parent.blur()}}),Q.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),Q.open(function(e){C.p.ignoreNextMousedown=t,e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function s(t){a=v(t.target)}function i(t){h.anticursor||h.startSelection(),c.seek(a,t.pageX,t.pageY).cursor.select(),a=void 0}function r(t){h.blink=u,h.selection||(c.editable?h.show():p.detach()),o.unbind("mousemove",s),v(t.target.ownerDocument).unbind("mousemove",i).unbind("mouseup",r)}var a,o=v(n.target).closest(".mq-root-block"),l=k.byId[o.attr(ue)||e.attr(ue)],c=l.controller,h=c.cursor,u=h.blink,p=c.textareaSpan,f=c.textarea;n.preventDefault(),n.target.unselectable=!0,h.options.ignoreNextMousedown(n)||(h.options.ignoreNextMousedown=t,c.blurred&&(c.editable||o.prepend(p),f.focus()),h.blink=t,c.seek(v(n.target),n.pageX,n.pageY).cursor.startSelection(),o.mousemove(s),v(n.target.ownerDocument).mousemove(i).mouseup(r))})}}),Q.open(function(t){t.seek=function(t,e,n){var s,r,a,o=this.notify("select").cursor;return t&&((s=t.attr(ue)||t.attr(he))||(r=t.parent(),s=r.attr(ue)||r.attr(he))),a=s?k.byId[s]:this.root,i("nodeId is the id of some Node that exists",a),o.clearSelection().show(),a.seek(e,o),this.scrollHoriz(),this}}),Q.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),k.open(function(t){t.keystroke=function(t,e,n){var s=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(b);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(x,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(b,t,e);case"End":n.notify("move").cursor.insAtRightEnd(s.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;s[x];)n.selectRight();break;case"Ctrl-Shift-End":for(;s[x]||s.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(s.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;s[b];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;s[b]||s.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(s[b])for(;s[b];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(s[x])for(;s[x];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(x);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);s[b];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){i("overridden or never called on this node")}}),Q.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,s=e+"Into",i=e+"OutOf";return n[x][s]?n.insAtLeftEnd(n[x][s]):n[b][s]?n.insAtRightEnd(n[b][s]):n.parent.bubble(function(t){var e=t[i];if(e&&("function"==typeof e&&(e=t[i](n)),e instanceof k&&n.jumpUpDown(t,e),!0!==e))return!1}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){r(t);var s=this.cursor;if(s.parent!==this.root&&n.preventDefault(),s.parent!==this.root)return s.parent.moveOutOf(t,s),this.notify("move")},_.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){r(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(b)},t.moveRight=function(){return this.moveDir(x)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n;return r(t),e=this.cursor,n=e.selection,this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[b].siblingDeleted&&e[b].siblingDeleted(e.options,x),e[x].siblingDeleted&&e[x].siblingDeleted(e.options,b),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){r(t);var e=this.cursor;return!e[t]||e.selection?this.deleteDir(t):(this.notify("edit"),t===b?y(e.parent.ends[b],e[b]).remove():y(e[x],e.parent.ends[x]).remove(),e.insAtDirEnd(t,e.parent),e[b].siblingDeleted&&e[b].siblingDeleted(e.options,x),e[x].siblingDeleted&&e[x].siblingDeleted(e.options,b),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(b)},t.deleteForward=function(){return this.deleteDir(x)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,s=n.selection;r(t),n.anticursor||n.startSelection(),e=n[t],e?s&&s.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},t.selectLeft=function(){return this.selectDir(b)},t.selectRight=function(){return this.selectDir(x)}}),Q.open(function(t){C.p.substituteTextarea=function(){return v("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=v('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=v(n).appendTo(e),t=this,t.cursor.selectionChanged=function(){t.selectionChanged()}},t.selectionChanged=function(){var t=this;ft(t.container[0]),void 0===t.textareaSelectionTimeout&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=void 0;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){i.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),s=e.textarea,i=e.textareaSpan;this.container.prepend(ce('<span class="mq-selectable">').text("$"+e.exportLatex()+"$")),e.blurred=!0,s.bind("cut paste",!1).bind("copy",function(){e.setTextareaSelection()}).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){s.val(t),t&&s.select()}},C.p.substituteKeyboardEvents=I,t.editablesTextareaEvents=function(){var t=this,e=t.textarea,n=t.textareaSpan,s=this.options.substituteKeyboardEvents(e,this);this.selectFn=function(t){s.select(t)},this.container.prepend(n),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})},t.copy=function(){this.setTextareaSelection()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),M=function(){function t(t){var e=W();return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||W();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[x],0);return n}var n=z.string,s=z.regex,i=z.letter,r=z.any,a=z.optWhitespace,o=z.succeed,l=z.fail,c=i.map(function(t){return J(t)}),h=s(/^[^${}\\_^]/).map(function(t){return P(t)}),u=s(/^[^\\a-eg-zA-Z]/).or(n("\\").then(s(/^[a-z]+/i).or(s(/^\s+/).result(" ")).or(r))).then(function(t){var e=O[t];return e?e(t).parser():l("unknown command: \\"+t)}),p=u.or(c).or(h),f=n("{").then(function(){return m}).skip(n("}")),d=a.then(f.or(p.map(t))),m=d.many().map(e).skip(a),g=n("[").then(d.then(function(t){return"]"!==t.join("latex")?o(t):l()}).many().map(e).skip(a)).skip(n("]")),q=m;return q.block=d,q.optBlock=g,q}(),Q.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e,n=this.notify("edit").cursor,s=z.all,i=z.eof,r=M.skip(i).or(s.result(!1)).parse(t);return r&&!r.isEmpty()&&(r.children().adopt(n.parent,n[b],n[x]),e=r.jQize(),e.insertBefore(n.jQ),n[b]=r.ends[x],r.finalizeInsert(n.options,n),r.ends[x][x].siblingCreated&&r.ends[x][x].siblingCreated(n.options,b),r.ends[b][b].siblingCreated&&r.ends[b][b].siblingCreated(n.options,x),n.parent.bubble("reflow")),this},t.renderLatexMath=function(t){var e,n,s=this.root,i=this.cursor,r=z.all,a=z.eof,o=M.skip(a).or(r.result(!1)).parse(t);s.eachChild("postOrder","dispose"),s.ends[b]=s.ends[x]=0,o&&o.children().adopt(s,0,0),e=s.jQ,o?(n=o.join("html"),e.html(n),s.jQize(e.children()),s.finalizeInsert(i.options)):e.empty(),delete i.selection,i.insAtRightEnd(s)},t.renderLatexText=function(t){var e,n,s,i,r,a,o,l,c,h,u=this.root,p=this.cursor;if(u.jQ.children().slice(1).remove(),u.eachChild("postOrder","dispose"),u.ends[b]=u.ends[x]=0,delete p.selection,p.show().insAtRightEnd(u),e=z.regex,n=z.string,s=z.eof,i=z.all,r=n("$").then(M).skip(n("$").or(s)).map(function(t){var e,n=G(p);return n.createBlocks(),e=n.ends[b],t.children().adopt(e,0,0),n}),a=n("\\$").result("$"),o=a.or(e(/^[^$]/)).map(P),l=r.or(o).many(),c=l.skip(s).or(i.result(!1)).parse(t)){for(h=0;h<c.length;h+=1)c[h].adopt(u,u.ends[x],0);u.jQize().appendTo(u.jQ),u.finalizeInsert(p.options)}}}),Q.open(function(t){t.scrollHoriz=function(){var t,e,n,s,i,r,a,o,l=this.cursor,c=l.selection,h=l.offset();if(h&&(t=l.jQ.closest(".mq-editable-field"),e=Number(h.top-t.offset().top+2*l.jQ.height()),t.find(".mq-textarea textarea").css("top",e+"px")),n=this.root.jQ[0].getBoundingClientRect(),c)if(r=c.jQ[0].getBoundingClientRect(),a=r.left-(n.left+20),o=r.right-(n.right-20),c.ends[b]===l[x])if(a<0)i=a;else{if(!(o>0))return;i=r.left-o<n.left+20?a:o}else if(o>0)i=o;else{if(!(a<0))return;i=r.right-a>n.right-20?o:a}else if((s=l.jQ[0].getBoundingClientRect().left)>n.right-20)i=s-(n.right-20);else{if(!(s<n.left+20))return;i=s-(n.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+i},100)}}),F=q(k,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[x].siblingCreated&&n[x].siblingCreated(t,b),n[b].siblingCreated&&n[b].siblingCreated(t,x),n.bubble("reflow")}}),$=q(F,function(t,e){t.init=function(t,n,s){var i=this;e.init.call(i),i.ctrlSeq||(i.ctrlSeq=t),n&&(i.htmlTemplate=n),s&&(i.textTemplate=s)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=M.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[x],0);return e})},t.createLeftOf=function(t){var n=this,s=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),s&&(s.adopt(n.ends[b],0,0),s.jQ.appendTo(n.ends[b].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){var t,e,n=this,s=n.numBlocks(),i=n.blocks=Array(s);for(t=0;t<s;t+=1)e=i[t]=W(),e.adopt(n,n.ends[x],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[b],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var s=n&&this[n+"Into"];e.insAtDirEnd(-t,s||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,
e[t]=this[t]},t.selectChildren=function(){return j(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[b]=t.jQ.offset().left,e[x]=e[b]+t.jQ.outerWidth(),e}var s,i=this,r=n(i);return t<r[b]?e.insLeftOf(i):t>r[x]?e.insRightOf(i):(s=r[b],void i.eachChild(function(a){var o=n(a);return t<o[b]?(t-s<o[b]-t?a[b]?e.insAtRightEnd(a[b]):e.insLeftOf(i):e.insAtLeftEnd(a),!1):t>o[x]?void(a[x]?s=o[x]:r[x]-t<t-o[x]?e.insRightOf(i):e.insAtRightEnd(a)):(a.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t,e,n,s=this,r=s.blocks,a=" mathquill-command-id="+s.id,o=s.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(i("no unmatched angle brackets",o.join("")===this.htmlTemplate),t=0,e=o[0];e;t+=1,e=o[t])if("/>"===e.slice(-2))o[t]=e.slice(0,-2)+a+"/>";else if("<"===e.charAt(0)){i("not an unmatched top-level close tag","/"!==e.charAt(1)),o[t]=e.slice(0,-1)+a+">",n=1;do{t+=1,e=o[t],i("no missing close tags",e),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1)}while(n>0)}return o.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+r[e].id+">"+r[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,s){e+=1;var i=s.text();return n&&"("===t.textTemplate[e]&&"("===i[0]&&")"===i.slice(-1)?n+i.slice(1,-1)+t.textTemplate[e]:n+s.text()+(t.textTemplate[e]||"")})}}),N=q($,function(e,n){e.init=function(t,e,s){s||(s=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[s])},e.parser=function(){return z.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},e.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),P=q(N,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),V=q(N,function(t,e){t.init=function(t,n,s){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",s)}}),W=q(F,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[b]===this.ends[x]&&0!==this.ends[b]?this.ends[b].text():this.join("text")},t.keystroke=function(t,n,s){return!s.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void s.escapeDir("Shift-Spacebar"===t?b:x,t,n))},t.moveOutOf=function(t,e,n){n&&this.parent[n+"Into"]||!this[t]?e.insDirOf(t,this.parent):e.insAtDirEnd(-t,this[t])},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[x];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[b].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[b];return n.seek(t,e)},t.chToCmd=function(t,e){var n;return t.match(/^[a-eg-zA-Z]$/)?J(t):/^\d$/.test(t)?X(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?O["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?O["×"](t):(n=T[t]||O[t])?n(t):P(t)},t.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),L.StaticMath=function(t){return q(t.AbstractMathQuill,function(e,n){this.RootBlock=W,e.__mathquillify=function(t,e){return this.config(t),n.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})},U=q(W,h),L.MathField=function(e){return q(e.EditableField,function(e,n){this.RootBlock=U,e.__mathquillify=function(e,s){return this.config(e),s>1&&(this.__controller.root.reflow=t),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},H=q(k,function(t,e){function n(t){var e,n;if(t.jQ[0].normalize(),e=t.jQ[0].firstChild)return i("only node in TextBlock span is Text node",3===e.nodeType),n=K(e.data),n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof y?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[b]&&this.ends[b].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n,s=this;if(e.createLeftOf.call(this,t),s[x].siblingCreated&&s[x].siblingCreated(t.options,b),s[b].siblingCreated&&s[b].siblingCreated(t.options,x),s.bubble("reflow"),t.insAtRightEnd(s),s.replacedText)for(n=0;n<s.replacedText.length;n+=1)s.write(t,s.replacedText.charAt(n))},t.parser=function(){var t=this,e=z.string,n=z.regex;return z.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return 0===e.length?y():(K(e).adopt(t,0,0),t)})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=$.prototype.selectTowards,t.deleteTowards=$.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){var s,i;t.show().deleteSelection(),"$"!==n?t[b]?t[b].appendText(n):K(n).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),P("\\$","$").createLeftOf(t)):t[x]?t[b]?(s=H(),i=this.ends[b],i.disown().jQ.detach(),i.adopt(s,0,0),t.insLeftOf(this),e.createLeftOf.call(s,t)):t.insLeftOf(this):t.insRightOf(this)},t.seek=function(t,e){var s,i,r,a,o,l,c,h;for(e.hide(),s=n(this),i=this.jQ.width()/this.text.length,r=Math.round((t-this.jQ.offset().left)/i),r<=0?e.insAtLeftEnd(this):r>=s.text.length?e.insAtRightEnd(this):e.insLeftOf(s.splitRight(r)),a=t-e.show().offset().left,o=a&&a<0?b:x,l=o;e[o]&&a*l>0;)e[o].moveTowards(o,e),l=a,a=t-e.offset().left;o*a<-o*l&&e[-o].moveTowards(-o,e),e.anticursor?e.anticursor.parent===this&&(c=e[b]&&e[b].text.length,this.anticursorPosition===c?e.anticursor=w.copy(e):(this.anticursorPosition<c?(h=e[b].splitRight(this.anticursorPosition),e[b]=h):h=e[x].splitRight(this.anticursorPosition-c),e.anticursor=w(this,h[b],h))):this.anticursorPosition=e[b]&&e[b].text.length},t.blur=function(t){W.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[b]===this?t[b]=this[b]:t[x]===this&&(t[x]=this[x])):n(this))},t.focus=W.prototype.focus}),K=q(k,function(t,e){function n(t,e){return e.charAt(t===b?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=v(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){r(e),e===x?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=K(this.text.slice(t)).adopt(this.parent,this,this[x]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var s,i;return r(t),s=n(-t,this.text),i=this[-t],i?i.insTextAtDirEnd(s,t):K(s).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===x?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var s,i,a,o;return r(t),s=e.anticursor,i=n(-t,this.text),s[t]===this?(a=K(i).createDir(t,e),s[t]=a,e.insDirOf(t,a)):(o=this[-t],o?o.insTextAtDirEnd(i,t):(a=K(i).createDir(-t,e),a.jQ.insDirOf(-t,e.selection.jQ)),1===this.text.length&&s[-t]===this&&(s[-t]=this[-t])),this.deleteTowards(t,e)}}),O.text=O.textnormal=O.textrm=O.textup=O.textmd=H,O.em=O.italic=O.italics=O.emph=O.textit=O.textsl=u("\\textit","i",'class="mq-text-mode"'),O.strong=O.bold=O.textbf=u("\\textbf","b",'class="mq-text-mode"'),O.sf=O.textsf=u("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),O.tt=O.texttt=u("\\texttt","span",'class="mq-monospace mq-text-mode"'),O.textsc=u("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),O.uppercase=u("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),O.lowercase=u("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),G=q($,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[b].cursor=this.cursor,this.ends[b].write=function(t,e){"$"!==e?W.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),P("\\$","$").createLeftOf(t.show())):t[x]?t[b]?W.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[b].latex()+"$"}}),Y=q(U,function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){if(t.show().deleteSelection(),"$"===e)G(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),P(e,n).createLeftOf(t)}}}),L.TextField=function(t){return q(t.EditableField,function(t,e){this.RootBlock=Y,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},X=q(P,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[b]instanceof Z&&!1!==t[b].isItalic||t[b]instanceof Ut&&t[b][b]instanceof Z&&!1!==t[b][b].isItalic)?(O._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),Z=q(N,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[b]||this[b]instanceof Z||this[b]instanceof V||"\\ "===this[b].ctrlSeq||(t="*"+t),!this[x]||this[x]instanceof V||this[x]instanceof Ut||(t+="*")),t}}),C.p.autoCommands={_maxLength:0},_.autoCommands=function(t){var e,n,s,i,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},s=0,i=0;i<e.length;i+=1){if(r=e[i],r.length<2)throw'autocommand "'+r+'" not minimum length of 2';if(O[r]===st)throw'"'+r+'" is a built-in operator name';n[r]=1,s=fe(s,r.length)}return n._maxLength=s,n},J=q(Z,function(t,e){function n(t){return!t||t instanceof V||t instanceof Ht}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n,s,i,r,a;if(e.createLeftOf.apply(this,arguments),n=t.options.autoCommands,s=n._maxLength,s>0){for(i="",r=this,a=0;r instanceof J&&r.ctrlSeq===r.letter&&a<s;)i=r.letter+i,r=r[b],a+=1;for(;i.length;){if(n.hasOwnProperty(i)){for(a=1,r=this;a<i.length;a+=1,r=r[b]);return y(r,this).remove(),t[b]=r[b],O[i](i).createLeftOf(t)}i=i.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==b&&this[x]instanceof J||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,s,i,r,a,o,l,c,h,u,p,f,d=t.autoOperatorNames;if(0!==d._maxLength){for(e=this.letter,s=this[b];s instanceof J;s=s[b])e=s.letter+e;for(i=this[x];i instanceof J;i=i[x])e+=i.letter;y(s[x]||this.parent.ends[b],i[b]||this.parent.ends[x]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(r=0,a=s[x]||this.parent.ends[b];r<e.length;r+=1,a=a[x])for(o=pe(d._maxLength,e.length-r);o>0;o-=1)if(l=e.slice(r,r+o),d.hasOwnProperty(l)){for(c=0,h=a;c<o;c+=1,h=h[x])h.italicize(!1),u=h;p=tt.hasOwnProperty(l),a.ctrlSeq=(p?"\\":"\\operatorname{")+a.ctrlSeq,u.ctrlSeq+=p?" ":"}",nt.hasOwnProperty(l)&&u[b][b][b].jQ.addClass("mq-last"),n(a[b])||a.jQ.addClass("mq-first"),n(u[x])||(u[x]instanceof Ut?(f=u[x],(f.siblingCreated=f.siblingDeleted=function(){f.jQ.toggleClass("mq-after-operator-name",!(f[x]instanceof Jt))})()):u.jQ.toggleClass("mq-last",!(u[x]instanceof Jt))),r+=o-1,a=u;continue t}}}}),tt={},et=C.p.autoOperatorNames={_maxLength:9},nt={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,s,i="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<i.length;t+=1)tt[i[t]]=et[i[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)tt[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)et[n[t]]=et["arc"+n[t]]=et[n[t]+"h"]=et["ar"+n[t]+"h"]=et["arc"+n[t]+"h"]=1;for(s="gcf hcf lcm proj span".split(" "),t=0;t<s.length;t+=1)et[s[t]]=1}(),_.autoOperatorNames=function(t){var e,n,s,i,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},s=0,i=0;i<e.length;i+=1){if(r=e[i],r.length<2)throw'"'+r+'" not minimum length of 2';n[r]=1,s=fe(s,r.length)}return n._maxLength=s,n},st=q(N,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)J(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=W();for(t=0;t<e.length;t+=1)J(e.charAt(t)).adopt(n,n.ends[x],0);return z.succeed(n.children())}});for(it in et)et.hasOwnProperty(it)&&(O[it]=st);O.operatorname=q($,function(e){e.createLeftOf=t,e.numBlocks=function(){return 1},e.parser=function(){return M.block.map(function(t){return t.children()})}}),O.f=q(J,function(t,e){t.init=function(){N.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),O[" "]=O.space=s(P,"\\ ","&nbsp;"),O[","]=s(P,"{,}",","),O["'"]=O.prime=s(P,"'","&prime;"),O["″"]=O.dprime=s(P,"″","&Prime;"),O.backslash=s(P,"\\backslash ","\\"),T["\\"]||(T["\\"]=O.backslash),O.$=s(P,"\\$","$"),rt=q(N,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}),O["@"]=rt,O["#"]=s(rt,"\\#","#"),O["&"]=s(rt,"\\&","&amp;"),O["%"]=s(rt,"\\%","%"),O.alpha=O.beta=O.gamma=O.delta=O.zeta=O.eta=O.theta=O.iota=O.kappa=O.mu=O.nu=O.xi=O.rho=O.sigma=O.tau=O.chi=O.psi=O.omega=q(Z,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),O.phi=s(Z,"\\phi ","&#981;"),O.phiv=O.varphi=s(Z,"\\varphi ","&phi;"),O.epsilon=s(Z,"\\epsilon ","&#1013;"),O.epsiv=O.varepsilon=s(Z,"\\varepsilon ","&epsilon;"),O.piv=O.varpi=s(Z,"\\varpi ","&piv;"),O.sigmaf=O.sigmav=O.varsigma=s(Z,"\\varsigma ","&sigmaf;"),O.thetav=O.vartheta=O.thetasym=s(Z,"\\vartheta ","&thetasym;"),O.upsilon=O.upsi=s(Z,"\\upsilon ","&upsilon;"),O.gammad=O.Gammad=O.digamma=s(Z,"\\digamma ","&#989;"),O.kappav=O.varkappa=s(Z,"\\varkappa ","&#1008;"),O.rhov=O.varrho=s(Z,"\\varrho ","&#1009;"),O.pi=O["π"]=s(rt,"\\pi ","&pi;"),O.lambda=s(rt,"\\lambda ","&lambda;"),O.Upsilon=O.Upsi=O.upsih=O.Upsih=s(N,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),O.Alpha=O.Beta=O.Epsilon=O.Zeta=O.Eta=O.Iota=O.Kappa=O.Mu=O.Nu=O.Omicron=O.Rho=O.Tau=O.Chi=O.Gamma=O.Delta=O.Theta=O.Lambda=O.Xi=O.Pi=O.Sigma=O.Phi=O.Psi=O.Omega=O.forall=q(P,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),at=q($,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=M.parse(this.latex);e.children().adopt(t.parent,t[b],t[x]),t[b]=e.ends[x],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[x][x].siblingCreated&&e.ends[x][x].siblingCreated(t.options,b),e.ends[b][b].siblingCreated&&e.ends[b][b].siblingCreated(t.options,x),t.parent.bubble("reflow")},t.parser=function(){var t=M.parse(this.latex).children();return z.succeed(t)}}),O["⁰"]=s(at,"^0"),O["¹"]=s(at,"^1"),O["²"]=s(at,"^2"),O["³"]=s(at,"^3"),O["⁴"]=s(at,"^4"),O["⁵"]=s(at,"^5"),O["⁶"]=s(at,"^6"),O["⁷"]=s(at,"^7"),O["⁸"]=s(at,"^8"),O["⁹"]=s(at,"^9"),O["₀"]=s(at,"_0"),O["₁"]=s(at,"_1"),O["₂"]=s(at,"_2"),O["₃"]=s(at,"_3"),O["₄"]=s(at,"_4"),O["₅"]=s(at,"_5"),O["₆"]=s(at,"_6"),O["₇"]=s(at,"_7"),O["₈"]=s(at,"_8"),O["₉"]=s(at,"_9"),O["¼"]=s(at,"\\frac14"),O["½"]=s(at,"\\frac12"),O["¾"]=s(at,"\\frac34"),ot=q(V,function(t){t.init=P.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){function n(t){return t[b]?t[b]instanceof V||/^[,;:\(\[]$/.test(t[b].ctrlSeq)?"":"mq-binary-operator":t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock()?n(t.parent.parent):""}if(e!==x)return this.jQ[0].className=n(this),this}}),O["+"]=s(ot,"+","+"),O["–"]=O["-"]=s(ot,"-","&minus;"),O["±"]=O.pm=O.plusmn=O.plusminus=s(ot,"\\pm ","&plusmn;"),O.mp=O.mnplus=O.minusplus=s(ot,"\\mp ","&#8723;"),T["*"]=O.sdot=O.cdot=s(V,"\\cdot ","&middot;","*"),lt=q(V,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var s=n?"Strict":"";e.init.call(this,t["ctrlSeq"+s],t["html"+s],t["text"+s])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){if(t===b&&!this.strict)return this.swap(!0),void this.bubble("reflow");e.deleteTowards.apply(this,arguments)}}),ct={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},ht={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},O["<"]=O.lt=s(lt,ct,!0),O[">"]=O.gt=s(lt,ht,!0),O["≤"]=O.le=O.leq=s(lt,ct,!1),O["≥"]=O.ge=O.geq=s(lt,ht,!1),ut=q(V,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){if(t[b]instanceof lt&&t[b].strict)return t[b].swap(!1),void t[b].bubble("reflow");e.createLeftOf.apply(this,arguments)}}),O["="]=ut,O["×"]=O.times=s(V,"\\times ","&times;","[x]"),O["÷"]=O.div=O.divide=O.divides=s(V,"\\div ","&divide;","[/]"),T["~"]=O.sim=s(V,"\\sim ","~","~"),O.notin=O.cong=O.equiv=O.oplus=O.otimes=q(V,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),O["≠"]=O.ne=O.neq=s(V,"\\ne ","&ne;"),O["∗"]=O.ast=O.loast=O.lowast=s(V,"\\ast ","&lowast;"),O.therefor=O.therefore=s(V,"\\therefore ","&there4;"),O.cuz=O.because=s(V,"\\because ","&#8757;"),O.prop=O.propto=s(V,"\\propto ","&prop;"),O["≈"]=O.asymp=O.approx=s(V,"\\approx ","&asymp;"),O["≢"]=O.notequiv=O.nequiv=s(V,"\\not\\equiv ","&#8802;"),O.isin=O.in=s(V,"\\in ","&isin;"),O.ni=O.contains=s(V,"\\ni ","&ni;"),O.notni=O.niton=O.notcontains=O.doesnotcontain=s(V,"\\not\\ni ","&#8716;"),O.sub=O.subset=s(V,"\\subset ","&sub;"),O.sup=O.supset=O.superset=s(V,"\\supset ","&sup;"),O.nsub=O.notsub=O.nsubset=O.notsubset=s(V,"\\not\\subset ","&#8836;"),O.nsup=O.notsup=O.nsupset=O.notsupset=O.nsuperset=O.notsuperset=s(V,"\\not\\supset ","&#8837;"),O.sube=O.subeq=O.subsete=O.subseteq=s(V,"\\subseteq ","&sube;"),O.supe=O.supeq=O.supsete=O.supseteq=O.supersete=O.superseteq=s(V,"\\supseteq ","&supe;"),O.nsube=O.nsubeq=O.notsube=O.notsubeq=O.nsubsete=O.nsubseteq=O.notsubsete=O.notsubseteq=s(V,"\\not\\subseteq ","&#8840;"),O.nsupe=O.nsupeq=O.notsupe=O.notsupeq=O.nsupsete=O.nsupseteq=O.notsupsete=O.notsupseteq=O.nsupersete=O.nsuperseteq=O.notsupersete=O.notsuperseteq=s(V,"\\not\\supseteq ","&#8841;"),O.quad=O.emsp=s(P,"\\quad ","    "),O.qquad=s(P,"\\qquad ","        "),O.diamond=s(P,"\\diamond ","&#9671;"),O.bigtriangleup=s(P,"\\bigtriangleup ","&#9651;"),O.ominus=s(P,"\\ominus ","&#8854;"),O.uplus=s(P,"\\uplus ","&#8846;"),O.bigtriangledown=s(P,"\\bigtriangledown ","&#9661;"),O.sqcap=s(P,"\\sqcap ","&#8851;"),O.triangleleft=s(P,"\\triangleleft ","&#8882;"),O.sqcup=s(P,"\\sqcup ","&#8852;"),O.triangleright=s(P,"\\triangleright ","&#8883;"),O.odot=O.circledot=s(P,"\\odot ","&#8857;"),O.bigcirc=s(P,"\\bigcirc ","&#9711;"),O.dagger=s(P,"\\dagger ","&#0134;"),O.ddagger=s(P,"\\ddagger ","&#135;"),O.wr=s(P,"\\wr ","&#8768;"),O.amalg=s(P,"\\amalg ","&#8720;"),O.models=s(P,"\\models ","&#8872;"),O.prec=s(P,"\\prec ","&#8826;"),O.succ=s(P,"\\succ ","&#8827;"),O.preceq=s(P,"\\preceq ","&#8828;"),O.succeq=s(P,"\\succeq ","&#8829;"),O.simeq=s(P,"\\simeq ","&#8771;"),O.mid=s(P,"\\mid ","&#8739;"),O.nmid=s(P,"\\nmid","&#8740;"),O.ll=s(P,"\\ll ","&#8810;"),O.gg=s(P,"\\gg ","&#8811;"),O.parallel=s(P,"\\parallel ","&#8741;"),O.nparallel=s(P,"\\nparallel ","&#8742;"),O.bowtie=s(P,"\\bowtie ","&#8904;"),O.sqsubset=s(P,"\\sqsubset ","&#8847;"),O.sqsupset=s(P,"\\sqsupset ","&#8848;"),O.smile=s(P,"\\smile ","&#8995;"),O.sqsubseteq=s(P,"\\sqsubseteq ","&#8849;"),O.sqsupseteq=s(P,"\\sqsupseteq ","&#8850;"),O.doteq=s(P,"\\doteq ","&#8784;"),O.frown=s(P,"\\frown ","&#8994;"),O.vdash=s(P,"\\vdash ","&#8870;"),O.dashv=s(P,"\\dashv ","&#8867;"),O.nless=s(P,"\\nless ","&#8814;"),O.ngtr=s(P,"\\ngtr ","&#8815;"),O.complement=s(P,"\\complement ","&#8705;"),O.veebar=s(P,"\\veebar ","&#8891;"),O.longleftarrow=s(P,"\\longleftarrow ","&xlarr;"),O.longrightarrow=s(P,"\\longrightarrow ","&xrarr;"),O.Longleftarrow=s(P,"\\Longleftarrow ","&xlArr;"),O.Longrightarrow=s(P,"\\Longrightarrow ","&xrArr;"),O.longleftrightarrow=s(P,"\\longleftrightarrow ","&xharr;"),O.updownarrow=s(P,"\\updownarrow ","&#8597;"),O.Longleftrightarrow=s(P,"\\Longleftrightarrow ","&xhArr;"),O.Updownarrow=s(P,"\\Updownarrow ","&#8661;"),O.mapsto=s(P,"\\mapsto ","&#8614;"),O.nearrow=s(P,"\\nearrow ","&#8599;"),O.rightleftarrows=s(P,"\\rightleftarrows  ","&#8644;"),O.leftrightarrows=s(P,"\\leftrightarrows  ","&#8646;"),O.rightleftharpoons=s(P,"\\rightleftharpoons ","&#8652;"),O.leftrightharpoons=s(P,"\\leftrightharpoons ","&#8651;"),O.hookleftarrow=s(P,"\\hookleftarrow ","&#8617;"),O.hookrightarrow=s(P,"\\hookrightarrow ","&#8618;"),O.searrow=s(P,"\\searrow ","&#8600;"),O.leftharpoonup=s(P,"\\leftharpoonup ","&#8636;"),O.rightharpoonup=s(P,"\\rightharpoonup ","&#8640;"),O.swarrow=s(P,"\\swarrow ","&#8601;"),O.leftharpoondown=s(P,"\\leftharpoondown ","&#8637;"),O.rightharpoondown=s(P,"\\rightharpoondown ","&#8641;"),O.nwarrow=s(P,"\\nwarrow ","&#8598;"),O.ldots=s(P,"\\ldots ","&#8230;"),O.cdots=s(P,"\\cdots ","&#8943;"),O.vdots=s(P,"\\vdots ","&#8942;"),O.iddots=s(P,"\\iddots ","&#x22F0;"),O.ddots=s(P,"\\ddots ","&#8945;"),O.surd=s(P,"\\surd ","&#8730;"),O.mho=s(P,"\\mho ","&#8487;"),O.checkmark=s(P,"\\checkmark ","&check;"),O.triangle=s(P,"\\triangle ","&#9651;"),O.ell=s(P,"\\ell ","&#8467;"),O.top=s(P,"\\top ","&#8868;"),O.flat=s(P,"\\flat ","&#9837;"),O.natural=s(P,"\\natural ","&#9838;"),O.sharp=s(P,"\\sharp ","&#9839;"),O.wp=s(P,"\\wp ","&#8472;"),O.bot=s(P,"\\bot ","&#8869;"),O.clubsuit=s(P,"\\clubsuit ","&#9827;"),O.diamondsuit=s(P,"\\diamondsuit ","&#9826;"),O.heartsuit=s(P,"\\heartsuit ","&#9825;"),O.spadesuit=s(P,"\\spadesuit ","&#9824;"),O.parallelogram=s(P,"\\parallelogram ","&#9649;"),O.square=s(P,"\\square ","&#9633;"),O.blacksquare=s(P,"\\blacksquare ","&#9632;"),O.imath=O.i=s(P,"\\imath ","&imath;"),O.jmath=O.j=s(P,"\\jmath ","&#567;"),O.lfloor=s(P,"\\lfloor ","&#8970;"),O.rfloor=s(P,"\\rfloor ","&#8971;"),O.lceil=s(P,"\\lceil ","&#8968;"),O.rceil=s(P,"\\rceil ","&#8969;"),O.opencurlybrace=O.lbrace=s(P,"\\lbrace ","{"),O.closecurlybrace=O.rbrace=s(P,"\\rbrace ","}"),O.lbrack=s(P,"["),O.rbrack=s(P,"]"),O.slash=s(P,"/"),O.backsim=s(P,"\\backsim","&#x223D;"),O.backsimeq=s(P,"\\backsimeq","&#8909;"),O.star=s(P,"\\star","&#128969;"),O.maltese=s(P,"\\maltese","&#10016;"),O.bigstar=s(P,"\\bigstar","&#9733;"),O.copyright=s(P,"\\copyright","&#169;"),O.circledR=s(P,"\\circledR","&#174;"),O.approxeq=s(P,"\\approxeq","≊"),O.ggg=s(P,"\\ggg","⋙");O.lll=s(P,"\\lll","⋘"),O.ncong=s(P,"\\ncong","≆"),O.ngeq=s(P,"\\ngeq","≱"),O.nleq=s(P,"\\nleq","≰"),O.vert=s(P,"|"),O.perp=O.perpendicular=s(P,"\\perp ","&perp;"),O.nabla=O.del=s(P,"\\nabla ","&nabla;"),O.hbar=s(P,"\\hbar ","&#8463;"),O.Vert=s(P,"\\Vert ","&#8214;"),O.AA=O.Angstrom=O.angstrom=s(P,"\\text\\AA ","&#8491;"),O.ring=O.circ=O.circle=s(P,"\\circ ","&#8728;"),O.bull=O.bullet=s(P,"\\bullet ","&bull;"),O.setminus=O.smallsetminus=s(P,"\\setminus ","&#8726;"),O["¬"]=O.neg=s(P,"\\neg ","&not;"),O.not=q(P,function(t,e){t.suffixes={"\\equiv":"notequiv","\\ni":"notni","\\subset":"notsubset","\\subseteq":"notsubseteq","\\supset":"notsupset","\\supseteq":"notsupseteq"},t.init=function(){return e.init.call(this,"\\neg ","&not;")},t.parser=function(){function e(t){var n=z.string(t.shift());return t.length?n.or(e(t)):n}var n=z.succeed,s=z.optWhitespace;return e(Object.keys(t.suffixes).sort(function(t,e){return e.length-t.length})).then(function(e){return s.then(n(O[t.suffixes[e]]()))}).or(s.then(n(this)))}}),O["…"]=O.dots=O.ellip=O.hellip=O.ellipsis=O.hellipsis=s(P,"\\dots ","&hellip;"),O.converges=O.darr=O.dnarr=O.dnarrow=O.downarrow=s(P,"\\downarrow ","&darr;"),O.dArr=O.dnArr=O.dnArrow=O.Downarrow=s(P,"\\Downarrow ","&dArr;"),O.diverges=O.uarr=O.uparrow=s(P,"\\uparrow ","&uarr;"),O.uArr=O.Uparrow=s(P,"\\Uparrow ","&uArr;"),O.to=s(V,"\\to ","&rarr;"),O.rarr=O.rightarrow=s(P,"\\rightarrow ","&rarr;"),O.implies=s(V,"\\Rightarrow ","&rArr;"),O.rArr=O.Rightarrow=s(P,"\\Rightarrow ","&rArr;"),O.gets=s(V,"\\gets ","&larr;"),O.larr=O.leftarrow=s(P,"\\leftarrow ","&larr;"),O.impliedby=s(V,"\\Leftarrow ","&lArr;"),O.lArr=O.Leftarrow=s(P,"\\Leftarrow ","&lArr;"),O.harr=O.lrarr=O.leftrightarrow=s(P,"\\leftrightarrow ","&harr;"),O.iff=s(V,"\\Leftrightarrow ","&hArr;"),O.hArr=O.lrArr=O.Leftrightarrow=s(P,"\\Leftrightarrow ","&hArr;"),O.Re=O.Real=O.real=s(P,"\\Re ","&real;"),O.Im=O.imag=O.image=O.imagin=O.imaginary=O.Imaginary=s(P,"\\Im ","&image;"),O.part=O.partial=s(P,"\\partial ","&part;"),O.infty=O.infin=O.infinity=s(P,"\\infty ","&infin;"),O.alef=O.alefsym=O.aleph=O.alephsym=s(P,"\\aleph ","&alefsym;"),O.xist=O.xists=O.exist=O.exists=s(P,"\\exists ","&exist;"),O.nexists=O.nexist=s(P,"\\nexists ","&#8708;"),O.and=O.land=O.wedge=s(V,"\\wedge ","&and;"),O.or=O.lor=O.vee=s(V,"\\vee ","&or;"),O.empty=O.emptyset=s(V,"\\empty ","&#x2205;"),O.o=O.O=O.oslash=O.Oslash=O.nothing=O.varnothing=s(V,"\\varnothing ","&empty;"),O.cup=O.union=s(V,"\\cup ","&cup;"),O.cap=O.intersect=O.intersection=s(V,"\\cap ","&cap;"),O.deg=O.degree=s(P,"\\degree ","&deg;"),O.ang=O.angle=s(P,"\\angle ","&ang;"),O.measuredangle=s(P,"\\measuredangle ","&#8737;"),O.sphericalangle=s(P,"\\sphericalangle ","&#8738;"),ft=t,dt=document.createElement("div"),mt=dt.style,gt={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(bt in gt)if(bt in mt){qt=bt;break}qt?pt=function(t,e,n){t.css(qt,"scale("+e+","+n+")")}:"filter"in mt?(ft=function(t){t.className=t.className},pt=function(t,e,n){function s(){t.css("marginRight",(i.width()-1)*(e-1)/e+"px")}var i,r;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),i=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),s(),r=setInterval(s),v(window).load(function(){clearTimeout(r),s()})}):pt=function(t,e,n){t.css("fontSize",n+"em")},xt=q($,function(t,e){t.init=function(t,n,s){e.init.call(this,t,"<"+n+" "+s+">&0</"+n+">")}}),q(Z,function(t,e){t.symbols={C:"&#8450;",H:"&#8461;",N:"&#8469;",P:"&#8473;",Q:"&#8474;",R:"&#8477;",Z:"&#8484;"},t.init=function(t){var n=t;this.symbols[t]&&(n='<span class="mq-original">'+t+"</span>"+this.symbols[t]),e.init.call(this,t,n)}}),O.cal=O.mathcal=s(xt,"\\mathcal","span",'class="mq-caligraphic mq-font"'),O.mathrm=s(xt,"\\mathrm","span",'class="mq-roman mq-font"'),O.mathit=s(xt,"\\mathit","i",'class="mq-font"'),O.mathfrak=O.frak=s(xt,"\\mathfrak","span",'class="mq-fraktur mq-font"'),O.mathscr=s(xt,"\\mathscr","span",'class="mq-script mq-font"'),O.mathbb=O.Bbb=s(xt,"\\mathbb","span",'class="mq-mathbb mq-font"'),O.mathbf=s(xt,"\\mathbf","b",'class="mq-font"'),O.mathsf=s(xt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),O.mathtt=s(xt,"\\mathtt","span",'class="mq-monospace mq-font"'),O.underline=s(xt,"\\underline","span",'class="mq-non-leaf mq-underline"'),O.overline=O.bar=s(xt,"\\overline","span",'class="mq-non-leaf mq-overline"'),O.sout=O.bar=s(xt,"\\sout","span",'class="mq-non-leaf mq-sout"'),O.cancel=O.bar=s(xt,"\\cancel","span",'class="mq-non-leaf mq-cancel"'),O.bcancel=O.bar=s(xt,"\\bcancel","span",'class="mq-non-leaf mq-bcancel"'),O.xcancel=O.bar=s(xt,"\\xcancel","span",'class="mq-non-leaf mq-xcancel"'),O.boxed=O.bar=s(xt,"\\boxed","span",'class="mq-non-leaf mq-boxed"'),vt=q($,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span "+n+'><span class="mq-arrow-inner">&0</span></span>')}}),O.overrightarrow=s(vt,"\\overrightarrow",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),O.overleftarrow=s(vt,"\\overleftarrow",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),O.overleftrightarrow=s(vt,"\\overleftrightarrow",'class="mq-non-leaf mq-overarrow mq-arrow-leftright"'),O.overlinesegment=s(vt,"\\overlinesegment",'class="mq-non-leaf mq-overlinesegment mq-arrow-leftright"'),O.underrightarrow=s(vt,"\\underrightarrow",'class="mq-non-leaf mq-underarrow mq-arrow-right"'),O.underleftarrow=s(vt,"\\underleftarrow",'class="mq-non-leaf mq-underarrow mq-arrow-left"'),O.underleftrightarrow=s(vt,"\\underleftrightarrow",'class="mq-non-leaf mq-underarrow mq-arrow-leftright"'),O.underlinesegment=s(vt,"\\underlinesegment",'class="mq-non-leaf mq-underlinesegment mq-arrow-leftright"'),wt=q($,function(t,e){t.ctrlSeq="\\xrightleftharpoons",t.htmlTemplate='<span class="mq-harpoons mq-harpoons-rightleft mq-non-leaf"><span class="mq-harpoons-numerator">&0</span><span class="mq-harpoons-harpoons">&#x21cc;</span></span>'}),kt=O.xrightleftharpoons=q(wt,function(t,e){t.ctrlSeq="\\xrightleftharpoons",t.htmlTemplate='<span class="mq-harpoons mq-harpoons-rightleft mq-non-leaf"><span class="mq-harpoons-numerator">&1</span><span class="mq-harpoons-harpoons">&#x21cc;</span><span class="mq-harpoons-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=kt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=wt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),yt=q($,function(t,e){t.ctrlSeq="\\xleftrightharpoons",t.htmlTemplate='<span class="mq-xleftrightharpoons mq-xleftrightharpoons-leftrightharpoonsleft mq-non-leaf"><span class="mq-xleftrightharpoons-numerator">&0</span><span class="mq-xleftrightharpoons-xleftrightharpoons">&#8651;</span></span>'}),Ot=O.xleftrightharpoons=q(yt,function(t,e){
t.ctrlSeq="\\xleftrightharpoons",t.htmlTemplate='<span class="mq-xleftrightharpoons mq-xleftrightharpoons-leftrightharpoonsleft mq-non-leaf"><span class="mq-xleftrightharpoons-numerator">&1</span><span class="mq-xleftrightharpoons-xleftrightharpoons">&#8651;</span><span class="mq-xleftrightharpoons-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Ot();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=yt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Tt=q($,function(t,e){t.ctrlSeq="\\xrightarrow",t.htmlTemplate='<span class="mq-xright mq-xright-rightleft mq-non-leaf"><span class="mq-xright-numerator">&0</span><span class="mq-xright-xright">&xrArr;</span></span>'}),St=O.xrightarrow=q(Tt,function(t,e){t.ctrlSeq="\\xrightarrow",t.htmlTemplate='<span class="mq-xright mq-xright-rightleft mq-non-leaf"><span class="mq-xright-numerator">&1</span><span class="mq-xright-xright">&xrarr;</span><span class="mq-xright-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=St();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Tt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),jt=q($,function(t,e){t.ctrlSeq="\\xRightarrow",t.htmlTemplate='<span class="mq-xRight mq-xRight-Rightleft mq-non-leaf"><span class="mq-xRight-numerator">&0</span><span class="mq-xRight-xRight">&xrarr;</span></span>'}),O.xRightarrow=q(jt,function(t,e){t.ctrlSeq="\\xRightarrow",t.htmlTemplate='<span class="mq-xRight mq-xRight-Rightleft mq-non-leaf"><span class="mq-xRight-numerator">&1</span><span class="mq-xRight-xRight">&xrArr;</span><span class="mq-xRight-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=St();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Tt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Qt=q($,function(t,e){t.ctrlSeq="\\xleftarrow",t.htmlTemplate='<span class="mq-xleft mq-xleft-rightleft mq-non-leaf"><span class="mq-xleft-numerator">&0</span><span class="mq-xleft-xleft">&xlarr;</span></span>'}),Lt=O.xleftarrow=q(Qt,function(t,e){t.ctrlSeq="\\xleftarrow",t.htmlTemplate='<span class="mq-xleft mq-xleft-rightleft mq-non-leaf"><span class="mq-xleft-numerator">&1</span><span class="mq-xleft-xleft">&xlarr;</span><span class="mq-xleft-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Lt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Qt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Ct=q($,function(t,e){t.ctrlSeq="\\xLeftarrow",t.htmlTemplate='<span class="mq-xLeft mq-xLeft-rightLeft mq-non-leaf"><span class="mq-xLeft-numerator">&0</span><span class="mq-xLeft-xLeft">&xlArr;</span></span>'}),_t=O.xLeftarrow=q(Ct,function(t,e){t.ctrlSeq="\\xLeftarrow",t.htmlTemplate='<span class="mq-xLeft mq-xLeft-rightLeft mq-non-leaf"><span class="mq-xLeft-numerator">&1</span><span class="mq-xLeft-xLeft">&xlArr;</span><span class="mq-xLeft-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=_t();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Ct();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Dt=q($,function(t,e){t.ctrlSeq="\\xleftrightarrow",t.htmlTemplate='<span class="mq-xleftright mq-xleftright-leftright mq-non-leaf"><span class="mq-xleftright-numerator">&0</span><span class="mq-xleftright-xleftright">&xharr;</span></span>'}),Et=O.xleftrightarrow=q(Dt,function(t,e){t.ctrlSeq="\\xleftrightarrow",t.htmlTemplate='<span class="mq-xleftright mq-xleftright-leftright mq-non-leaf"><span class="mq-xleftright-numerator">&1</span><span class="mq-xleftright-xleftright">&xharr;</span><span class="mq-xleftright-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Et();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Dt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),At=q($,function(t,e){t.ctrlSeq="\\xLeftrightarrow",t.htmlTemplate='<span class="mq-xLeftright mq-xLeftright-Leftright mq-non-leaf"><span class="mq-xLeftright-numerator">&0</span><span class="mq-xLeftright-xLeftright">&xhArr;</span></span>'}),Rt=O.xLeftrightarrow=q(At,function(t,e){t.ctrlSeq="\\xLeftrightarrow",t.htmlTemplate='<span class="mq-xLeftright mq-xLeftright-Leftright mq-non-leaf"><span class="mq-xLeftright-numerator">&1</span><span class="mq-xLeftright-xLeftright">&xhArr;</span><span class="mq-xLeftright-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Rt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=At();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Bt=q($,function(t,e){t.ctrlSeq="\\xhookrightarrow",t.htmlTemplate='<span class="mq-xhookright mq-xhookright-hookright mq-non-leaf"><span class="mq-xhookright-numerator">&0</span><span class="mq-xhookright-xhookright">&#8618;</span></span>'}),It=O.xhookrightarrow=q(Bt,function(t,e){t.ctrlSeq="\\xhookrightarrow",t.htmlTemplate='<span class="mq-xhookright mq-xhookright-righthookright mq-non-leaf"><span class="mq-xhookright-numerator">&1</span><span class="mq-xhookright-xhookright">&#8618;</span><span class="mq-xhookright-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=It();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Bt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),zt=q($,function(t,e){t.ctrlSeq="\\xhookleftarrow",t.htmlTemplate='<span class="mq-xhookleft mq-xhookleft-hookleft mq-non-leaf"><span class="mq-xhookleft-numerator">&0</span><span class="mq-xhookleft-xhookleft">&larrhk;</span></span>'}),Mt=O.xhookleftarrow=q(zt,function(t,e){t.ctrlSeq="\\xhookleftarrow",t.htmlTemplate='<span class="mq-xhookleft mq-xhookleft-righthookleft mq-non-leaf"><span class="mq-xhookleft-numerator">&1</span><span class="mq-xhookleft-xhookleft">&larrhk;</span><span class="mq-xhookleft-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Mt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=zt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Ft=q($,function(t,e){t.ctrlSeq="\\xtofrom",t.htmlTemplate='<span class="mq-xtofrom mq-xtofrom-tofrom mq-non-leaf"><span class="mq-xtofrom-numerator">&0</span><span class="mq-xtofrom-xtofrom">&rlarr;</span></span>'}),$t=O.xtofrom=q(Ft,function(t,e){t.ctrlSeq="\\xtofrom",t.htmlTemplate='<span class="mq-xtofrom mq-xtofrom-tofrom mq-non-leaf"><span class="mq-xtofrom-numerator">&1</span><span class="mq-xtofrom-xtofrom">&rlarr;</span><span class="mq-xtofrom-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=$t();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Ft();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Nt=q($,function(t,e){t.ctrlSeq="\\xlongequal",t.htmlTemplate='<span class="mq-xlongequal mq-xlongequal-longequal mq-non-leaf"><span class="mq-xlongequal-numerator">&0</span><span class="mq-xlongequal-xlongequal">=</span></span>'}),Pt=O.xlongequal=q(Nt,function(t,e){t.ctrlSeq="\\xlongequal",t.htmlTemplate='<span class="mq-xlongequal mq-xlongequal-longequal mq-non-leaf"><span class="mq-xlongequal-numerator">&1</span><span class="mq-xlongequal-xlongequal">=</span><span class="mq-xlongequal-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Pt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Nt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Vt=q($,function(t,e){t.ctrlSeq="\\xmapsto",t.htmlTemplate='<span class="mq-xmapsto mq-xmapsto-mapsto mq-non-leaf"><span class="mq-xmapsto-numerator">&0</span><span class="mq-xmapsto-xmapsto">&#10236;</span></span>'}),Wt=O.xmapsto=q(Vt,function(t,e){t.ctrlSeq="\\xmapsto",t.htmlTemplate='<span class="mq-xmapsto mq-xmapsto-mapsto mq-non-leaf"><span class="mq-xmapsto-numerator">&1</span><span class="mq-xmapsto-xmapsto">&#10236;</span><span class="mq-xmapsto-denominator">&0</span></span>',t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Wt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(M.block.map(function(t){var e=Vt();return e.blocks=[t],t.adopt(e,0,0),e}))},t.latex=function(){return this.ctrlSeq+"["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),O.overgroup=O.overarc=s(xt,"\\overgroup","span",'class="mq-non-leaf mq-overarc"'),O.overbrace=O.overarc=s(xt,"\\overbrace","span",'class="mq-non-leaf mq-overarc"'),O.undergroup=O.underarc=s(xt,"\\undergroup","span",'class="mq-non-leaf mq-underarc"'),O.underbrace=O.overarc=s(xt,"\\underbrace","span",'class="mq-non-leaf mq-underarc"'),O.dot=q($,function(t,e){t.init=function(){e.init.call(this,"\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#775;</span><span class="mq-empty-box">&0</span></span></span>')}}),O.ddot=q($,function(t,e){t.init=function(){e.init.call(this,"\\ddot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#776;</span><span class="mq-empty-box">&0</span></span></span>')}}),O.dddot=q($,function(t,e){t.init=function(){e.init.call(this,"\\dddot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring"> &#8411;</span><span class="mq-empty-box">&0</span></span></span>')}}),O.textcolor=q($,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=z.optWhitespace,s=z.string,i=z.regex;return n.then(s("{")).then(i(/^[#\w\s.,()%-]*/)).skip(s("}")).then(function(n){return t.setColor(n),e.parser.call(t)})},t.isStyleBlock=function(){return!0}}),O.class=q($,function(t,e){t.parser=function(){var t=this,n=z.string,s=z.regex;return z.optWhitespace.then(n("{")).then(s(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.cls=n||"",t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})},t.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},t.isStyleBlock=function(){return!0}}),Ut=q($,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(this.replacedFragment||t[b]||!t.options.supSubsRequireOperand)return e.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){var e,n,s,i,r,a;for(e=b;e;e=e===b&&x)if(this[e]instanceof Ut){for(n="sub";n;n="sub"===n&&"sup")s=this[n],i=this[e][n],s&&(i?s.isEmpty()?a=w(i,0,i.ends[b]):(s.jQ.children().insAtDirEnd(-e,i.jQ),r=s.children().disown(),a=w(i,r.ends[x],i.ends[b]),e===b?r.adopt(i,i.ends[x],0):r.adopt(i,0,i.ends[b])):this[e].addBlock(s.disown()),this.placeCursor=function(t,n){return function(s){s.insAtDirEnd(-e,t||n)}}(i,s));this.remove(),t&&t[b]===this&&(e===x&&a?a[b]?t.insRightOf(a[b]):t.insAtLeftEnd(a.parent):t.insRightOf(this[e]));break}},C.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[b].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e,t.options);return n instanceof N?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[b]&&!t[x]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),W.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,s){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var s=this.sub.ends[-t];s instanceof N?s.remove():s&&s.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(b,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.text=function(){function t(t,e){var n=e&&e.text();return e?t+(1===n.length?n:"("+(n||" ")+")"):""}return t("_",this.sub)+t("^",this.sup)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=v('<span class="mq-sup"/>').append(t.jQ.children()).attr(ue,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=v('<span class="mq-sub"></span>').append(t.jQ.children()).attr(ue,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(t,e,n,s){t[e].deleteOutOf=function(i,r){if(r.insDirOf(this[i]?-i:i,this.parent),!this.isEmpty()){var a=this.ends[i];this.children().disown().withDirAdopt(i,r.parent,r[i],r[-i]).jQ.insDirOf(-i,r.jQ),r[-i]=a}t.supsub=n,delete t[e],delete t[s+"Into"],t[n][s+"OutOf"]=p,delete t[n].deleteOutOf,"sub"===e&&v(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}),O.subscript=O._=q(Ut,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[b],this.sub.upOutOf=p,e.finalizeTree.call(this)}}),O.superscript=O.supscript=O["^"]=q(Ut,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^(",")"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[x],this.sup.downOutOf=p,e.finalizeTree.call(this)}}),Ht=q($,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';N.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(J("n").createLeftOf(t),ut().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[b].latex())+"^"+t(this.ends[x].latex())},t.parser=function(){var t,e=z.string,n=z.optWhitespace,s=z.succeed,i=M.block,r=this,a=r.blocks=[W(),W()];for(t=0;t<a.length;t+=1)a[t].adopt(r,r.ends[x],0);return n.then(e("_").or(e("^"))).then(function(t){var e=a["_"===t?0:1];return i.then(function(t){return t.children().adopt(e,e.ends[x],0),s(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[b],this.upInto=this.ends[x],this.ends[b].upOutOf=this.ends[x],this.ends[x].downOutOf=this.ends[b]}}),O["∑"]=O.sum=O.summation=s(Ht,"\\sum ","&sum;"),O["∏"]=O.prod=O.product=s(Ht,"\\prod ","&prod;"),O.coprod=O.coproduct=s(Ht,"\\coprod ","&#8720;"),O.bigsqcup=s(Ht,"\\bigsqcup ","&#8852;"),O.bigcup=s(Ht,"\\bigcup ","&#8746;"),O.bigcap=s(Ht,"\\bigcap ","&#8745;"),O.bigvee=s(Ht,"\\bigvee ","&#8744;"),O.bigwedge=s(Ht,"\\bigwedge ","&#8743;"),O.bigodot=s(Ht,"\\bigodot ","&#8857;"),O.bigotimes=s(Ht,"\\bigotimes ","&#8855;"),O.bigoplus=s(Ht,"\\bigoplus ","&#8853;"),O.biguplus=s(Ht,"\\biguplus ","&#8846;"),O["∫"]=O.int=O.integral=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.iint=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\iint ",'<span class="mq-int mq-non-leaf"><big>&#8748;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.iiint=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\iiint ",'<span class="mq-int mq-non-leaf"><big>&#8749;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.oint=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\oint ",'<span class="mq-int mq-non-leaf"><big>&#8750;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.oiint=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\oiint ",'<span class="mq-int mq-non-leaf"><big>&#8751;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.oiiint=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\oiiint ",'<span class="mq-int mq-non-leaf"><big>&#8752;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.oiiint=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\oiiint ",'<span class="mq-int mq-non-leaf"><big>&#8752;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.intclockwise=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\intclockwise ",'<span class="mq-int mq-non-leaf"><big>&#8753;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.intctrclockwise=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\intctrclockwise ",'<span class="mq-int mq-non-leaf"><big>&#10769;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.varointclockwise=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\varointclockwise ",'<span class="mq-int mq-non-leaf"><big>&#8754;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.ointctrclockwise=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\ointctrclockwise ",'<span class="mq-int mq-non-leaf"><big>&#8755;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8755</span></span></span>')},t.createLeftOf=$.p.createLeftOf}),O.bigg=O.intsub=O.integralsubstitution=q(Ht,function(t,e){t.init=function(){N.prototype.init.call(this,"\\bigg",'<span class="mq-intsub mq-non-leaf"><big>/</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=$.p.createLeftOf,t.parser=function(){var t,e=this,n=z.string,s=z.optWhitespace,i=z.succeed;for(e.blocks=[W(),W()],t=0;t<e.blocks.length;t+=1)e.blocks[t].adopt(e,e.ends[x],0);return n("/_{").then(n("\\!").many()).then(M).then(function(t){return t.children().adopt(e.blocks[0],e.blocks[0].ends[x],0),i(e)}).then(s).then(n("}")).then(s).then(n("^")).then(M.block).then(function(t){return t.children().adopt(e.blocks[1],e.blocks[1].ends[x],0),i(e)})},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return"\\bigg/_{\\!\\!\\!\\!\\!"+t(this.blocks[0].latex())+"}^"+t(this.blocks[1].latex())}}),Kt=O.frac=O.dfrac=O.cfrac=O.fraction=q($,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[x].upOutOf=this.ends[b],this.downInto=this.ends[b].downOutOf=this.ends[x]}}),O.xarrow=q($,function(t,e){t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["xarrow[","](",")"],t.finalizeTree=function(){this.upInto=this.ends[x].upOutOf=this.ends[b],this.downInto=this.ends[b].downOutOf=this.ends[x]}}),Gt=O.over=T["/"]=q(Kt,function(e,n){e.createLeftOf=function(e){if(!this.replacedFragment){for(var s=e[b];s&&!(s instanceof V||s instanceof(O.text||t)||s instanceof Ht||"\\ "===s.ctrlSeq||/^[,;:]$/.test(s.ctrlSeq));)s=s[b];s instanceof Ht&&s[x]instanceof Ut&&(s=s[x],s[x]instanceof Ut&&s[x].ctrlSeq!=s.ctrlSeq&&(s=s[x])),s!==e[b]&&(this.replaces(y(s[x]||e.parent.ends[b],e[b])),e[b]=s)}n.createLeftOf.call(this,e)}}),Yt=O.sqrt=O["√"]=q($,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return M.optBlock.then(function(t){return M.block.map(function(e){var n=Xt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[x].jQ;pt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),O.phase=q($,function(t,e){t.ctrlSeq="\\phase",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-phase-prefix">&#x2220;</span><span class="mq-non-leaf mq-phase-stem">&0</span></span>',t.textTemplate=["phase(",")"],t.reflow=function(){var t=this.ends[x].jQ;pt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),O.hat=q($,function(t,e){t.ctrlSeq="\\hat",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',t.textTemplate=["hat(",")"]}),Xt=O.nthroot=q(Yt,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[b].latex()+"]{"+this.ends[x].latex()+"}"}}),Zt=q($,function(t,e){t.init=function(t,n,s){var i='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+n+'</span><span class="mq-diacritic-stem">&0</span></span>';e.init.call(this,t,i,s)}}),O.vec=s(Zt,"\\vec","&rarr;",["vec(",")"]),O.tilde=s(Zt,"\\tilde","~",["tilde(",")"]),Jt=q(q($,f),function(e,n){e.init=function(t,e,s,i,r){n.init.call(this,"\\left"+i,void 0,[e,s]),this.side=t,this.sides={},this.sides[b]={ch:e,ctrlSeq:i},this.sides[x]={ch:s,ctrlSeq:r}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===x?" mq-ghost":"")+'">'+this.sides[b].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===b?" mq-ghost":"")+'">'+this.sides[x].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[b].ctrlSeq+this.ends[b].latex()+"\\right"+this.sides[x].ctrlSeq},e.matchBrack=function(t,e,n){return n instanceof Jt&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||te[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[b].ch]===n.sides[x].ch)&&n},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===b?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){var e,s,i;this.replacedFragment||(e=t.options,s="|"===this.sides[b].ch?this.matchBrack(e,x,t[x])||this.matchBrack(e,b,t[b])||this.matchBrack(e,0,t.parent.parent):this.matchBrack(e,-this.side,t[-this.side])||this.matchBrack(e,-this.side,t.parent.parent)),s?(i=this.side=-s.side,this.closeOpposing(s),s===t.parent.parent&&t[i]&&y(t[i],t.parent.ends[i],-i).disown().withDirAdopt(-i,s.parent,s,s[i]).jQ.insDirOf(i,s.jQ),s.bubble("reflow")):(s=this,i=s.side,s.replacedFragment?s.side=0:t[-i]&&(s.replaces(y(t[-i],t.parent.ends[-i],i)),t[-i]=0),n.createLeftOf.call(s,t)),i===b?t.insAtLeftEnd(s.ends[b]):t.insRightOf(s)},e.placeCursor=t,e.unwrap=function(){this.ends[b].children().disown().adopt(this.parent,this,this[x]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var s,i,r,a=this.parent,o=this[t],l=a.ends[t];if(t===this.side)return this.unwrap(),void(o?n.insDirOf(-t,o):n.insAtDirEnd(t,a));if(s=n.options,i=!this.side,this.side=-t,this.matchBrack(s,t,this.ends[b].ends[this.side]))this.closeOpposing(this.ends[b].ends[this.side]),r=this.ends[b].ends[t],this.unwrap(),r.siblingCreated&&r.siblingCreated(n.options,t),o?n.insDirOf(-t,o):n.insAtDirEnd(t,a);else{if(this.matchBrack(s,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&i)return this.unwrap(),void(o?n.insDirOf(-t,o):n.insAtDirEnd(t,a));this.sides[t]={ch:te[this.sides[this.side].ch],ctrlSeq:te[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===b?0:1).addClass("mq-ghost").html(this.sides[t].ch)}o?(r=this.ends[b].ends[t],y(o,l,-t).disown().withDirAdopt(-t,this.ends[b],r,0).jQ.insAtDirEnd(t,this.ends[b].jQ.removeClass("mq-empty")),r.siblingCreated&&r.siblingCreated(n.options,t),n.insDirOf(-t,o)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[b])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[b].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===b?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),te={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},d("("),d("["),d("{","\\{"),O.langle=s(Jt,b,"&lang;","&rang;","\\langle ","\\rangle "),O.rangle=s(Jt,x,"&lang;","&rang;","\\langle ","\\rangle "),T["|"]=s(Jt,b,"|","|","|","|"),O.lVert=s(Jt,b,"&#8741;","&#8741;","\\lVert ","\\rVert "),O.rVert=s(Jt,x,"&#8741;","&#8741;","\\lVert ","\\rVert "),O.left=q($,function(t){t.parser=function(){var t=z.regex,e=z.string,n=(z.succeed,z.optWhitespace);return n.then(t(/^(?:[([|]|\\\{|\\langle\b|\\lVert\b)/)).then(function(s){var i="\\"===s.charAt(0)?s.slice(1):s;return"\\langle"==s&&(i="&lang;",s+=" "),"\\lVert"==s&&(i="&#8741;",s+=" "),M.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\}|\\rangle\b|\\rVert\b)/)).map(function(t){var e,n="\\"===t.charAt(0)?t.slice(1):t;return"\\rangle"==t&&(n="&rang;",t+=" "),"\\rVert"==t&&(n="&#8741;",t+=" "),e=Jt(0,i,n,s,t),e.blocks=[r],r.adopt(e,0,0),e})})})}}),O.right=q($,function(t){t.parser=function(){return z.fail("unmatched \\right")}}),ee=O.binom=O.binomial=q(q($,f),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}),O.choose=q(ee,function(t){t.createLeftOf=Gt.prototype.createLeftOf}),O.editable=O.MathQuillMathField=q($,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=z.string,s=z.regex,i=z.succeed;return n("[").then(s(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(i()).then(e.parser.call(t))},t.finalizeTree=function(t){var e=Q(this.ends[b],this.jQ,t);e.KIND_OF_MQ="MathField",e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),h(e.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[b].controller))},t.latex=function(){return this.ends[b].latex()},t.text=function(){return this.ends[b].text()}}),ne=O.embed=q(N,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this,e=z.string,n=z.regex,s=z.succeed;return e("{").then(n(/^[a-z][a-z0-9]*/i)).skip(e("}")).then(function(i){return e("[").then(n(/^[-\w\s]*/)).skip(e("]")).or(s()).map(function(e){return t.setOptions(E[i](e))})})}}),se={},O.begin=q($,function(t,e){t.parser=function(){var t=z.string,e=z.regex;return t("{").then(e(/^[a-z]+/i)).skip(t("}")).then(function(e){return(se[e]?se[e]().parser():z.fail("unknown environment type: "+e)).skip(t("\\end{"+e+"}"))})}}),ie=q($,function(t,e){t.template=[["\\begin{","}"],["\\end{","}"]],t.wrappers=function(){return[t.template[0].join(this.environment),t.template[1].join(this.environment)]}}),re=se.matrix=q(ie,function(t,e){var n={column:"&",row:"\\\\"};t.parentheses={left:null,right:null},t.environment="matrix",t.reflow=function(){var t=this.jQ.children("table"),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),n=this.jQ.children(".mq-paren");n.length&&pt(n,pe(1+.2*(e-1),1.2),1.05*e)},t.latex=function(){var t,e,s=this.hline,i="";return this.eachChild(function(e){void 0!==t&&(t!==e.row?(i+=n.row+"\n",s&&(i+="\\hline\n",s=!1)):i+=n.column),t=e.row,i+=e.latex()}),e=this.options?"{"+this.options+"}":"",this.wrappers().join(e+"\n"+i+"\n")},t.html=function(){function t(t){return t?'<span class="mq-scaled mq-paren">'+t+"</span>":""}var n,s=[],i="",r=0;return this.eachChild(function(t){n!==t.row&&(n=t.row,
i+="<tr>$tds</tr>",s[n]=[]),s[n].push("<td>&"+r+++"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-matrix-'+this.environment+' mq-non-leaf">'+t(this.parentheses.left)+'<table class="mq-non-leaf">'+i.replace(/\$tds/g,function(){return s.shift().join("")})+"</table>"+t(this.parentheses.right)+"</span>",e.html.call(this)},t.createBlocks=function(){"matrix"==this.ctrlSeq||"pmatrix"==this.ctrlSeq||"bmatrix"==this.ctrlSeq||"Bmatrix"==this.ctrlSeq||"vmatrix"==this.ctrlSeq||"Vmatrix"==this.ctrlSeq||"array"==this.ctrlSeq?this.blocks=[ae(0,this),ae(0,this),ae(1,this),ae(1,this)]:"gathered"==this.ctrlSeq||"aligned"==this.ctrlSeq?this.blocks=[ae(0,this,ae(1,this))]:"cases"!=this.ctrlSeq&&"rcases"!=this.ctrlSeq||(this.blocks=[ae(0,this),ae(1,this)])},t.parser=function(){var t=this,e=z.optWhitespace,s=z.string;return(0,z.regex)(/^({[clr](\|?[clr])*})?/).then(function(e){return e&&!t.options&&(t.options=e.slice(1,-1)),z.succeed(t)}).then(e.then(s(n.column).or(s(n.row)).or(s("\\hline ")).or(M.block)).many()).skip(e).then(function(e){function s(){t.blocks.push(ae(a,t,r)),r=[]}var i,r=[],a=0;for(t.blocks=[],i=0;i<e.length;i+=1)e[i]instanceof W?r.push(e[i]):"\\hline"===e[i]?t.hline=!0:(s(),e[i]===n.row&&(a+=1));return s(),t.autocorrect(),z.succeed(t)})},t.finalizeTree=function(){var t=this.jQ.find("table");t.toggleClass("mq-rows-1",1===t.find("tr").length),this.relink()},t.relink=function(){var t,e,n,s,i=this.blocks,r=[];for(s=0;s<i.length;s+=1)n=i[s],t!==n.row&&(t=n.row,r[t]=[],e=0),r[t][e]=n,n[x]=i[s+1],n[b]=i[s-1],r[t-1]&&r[t-1][e]&&(n.upOutOf=r[t-1][e],r[t-1][e].downOutOf=n),e+=1;this.ends[b]=i[0],this.ends[x]=i[i.length-1]},t.autocorrect=function(t){var e,n,s,i,r,a,o=[];for(t=[],e=this.blocks,a=0;a<e.length;a+=1)r=e[a].row,t[r]=t[r]||[],t[r].push(e[a]),o[r]=t[r].length;if((n=Math.max.apply(null,o))!==Math.min.apply(null,o)){for(a=0;a<t.length;a+=1)for(s=n-t[a].length;s;)i=n*a+t[a].length,e.splice(i,0,ae(a,this)),s-=1;this.relink()}},t.deleteCell=function(t){function e(t){var e,n=[];for(e=0;e<t.length;e+=1)t[e].isEmpty()&&n.push(t[e]);return n.length===t.length}function n(t){for(var e=0;e<t.length;e+=1)c.indexOf(t[e])>-1&&(t[e].remove(),c.splice(c.indexOf(t[e]),1))}var s,i,r=[],a=[],o=[],l=[],c=this.blocks;this.eachChild(function(e){s!==e.row&&(s=e.row,r[s]=[],i=0),a[i]=a[i]||[],a[i].push(e),r[s].push(e),e===t&&(o=r[s],l=a[i]),i+=1}),e(o)&&l.length>1&&(s=r.indexOf(o),this.eachChild(function(t){t.row>s&&(t.row-=1)}),n(o),this.jQ.find("tr").eq(s).remove()),e(l)&&o.length>1&&n(l),this.finalizeTree()},t.addRow=function(t){var e,n,s=[],i=[],r=[],a=v("<tr></tr>"),o=t.row,l=0;for(this.eachChild(function(t){t.row<=o&&s.push(t),t.row===o&&(l+=1),t.row>o&&(t.row+=1,r.push(t))}),n=0;n<l;n+=1)e=ae(o+1),e.parent=this,i.push(e),e.jQ=v('<td class="mq-empty">').attr(ue,e.id).appendTo(a);return this.jQ.find("tr").eq(o).after(a),this.blocks=s.concat(i,r),i[0]},t.addColumn=function(t){var e,n,s,i=[],r=[];for(this.eachChild(function(n){i[n.row]=i[n.row]||[],i[n.row].push(n),n===t&&(e=i[n.row].length)}),s=0;s<i.length;s+=1)n=ae(s),n.parent=this,r.push(n),i[s].splice(e,0,n),n.jQ=v('<td class="mq-empty">').attr(ue,n.id);return this.jQ.find("tr").each(function(t){v(this).find("td").eq(e-1).after(i[t][e].jQ)}),this.blocks=[].concat.apply([],i),r[t.row]},t.insert=function(t,e){var n=this[t](e);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(n)},t.backspace=function(t,e,n,s){var i=t[e];if(t.isEmpty()){for(this.deleteCell(t);i&&i[e]&&-1===this.blocks.indexOf(i);)i=i[e];i&&n.insAtDirEnd(-e,i),1===this.blocks.length&&this.blocks[0].isEmpty()&&(s(),this.finalizeTree()),this.bubble("edited")}}}),se.aligned=q(re,function(t,e){t.environment="aligned",t.parentheses={left:null,right:null}}),se.gathered=q(re,function(t,e){t.environment="gathered",t.parentheses={left:null,right:null}}),se.pmatrix=q(re,function(t,e){t.environment="pmatrix",t.parentheses={left:"(",right:")"}}),se.bmatrix=q(re,function(t,e){t.environment="bmatrix",t.parentheses={left:"[",right:"]"}}),se.Bmatrix=q(re,function(t,e){t.environment="Bmatrix",t.parentheses={left:"{",right:"}"}}),se.vmatrix=q(re,function(t,e){t.environment="vmatrix",t.parentheses={left:"|",right:"|"}}),se.Vmatrix=q(re,function(t,e){t.environment="Vmatrix",t.parentheses={left:"&#8214;",right:"&#8214;"}}),se.cases=q(re,function(t,e){t.environment="cases",t.parentheses={left:"{",right:null}}),se.rcases=q(re,function(t,e){t.environment="rcases",t.parentheses={left:null,right:"}"}}),se.array=q(re,function(t,e){t.environment="array",t.parentheses={left:null,right:null},t.hline=!0,t.options="l|l"}),ae=q(W,function(t,e){t.init=function(t,n,s){if(e.init.call(this),this.row=t,n&&this.adopt(n,n.ends[x],0),s)for(var i=0;i<s.length;i++)s[i].children().adopt(this,this.ends[x],0)},t.keystroke=function(t,n,s){var i,r,a,o,l,c;switch(t){case"Tab":if(i=this,r=0,this.parent.eachChild(function(t){t.row===i.row&&(t===i&&(a=r),r+=1)}),a===r-1)return n.preventDefault(),this.parent.insert("addColumn",this);break;case"Enter":if(o=this.row+1,l=!0,this.parent.eachChild(function(t){t.row===o&&(c||(c=t),t.isEmpty()||(l=!1))}),n.preventDefault(),c&&l){s.cursor.insAtDirEnd(b,c);break}return this.parent.insert("addRow",this)}return e.keystroke.apply(this,arguments)},t.deleteOutOf=function(t,n){var s=this,i=arguments;this.parent.backspace(this,t,n,function(){return e.deleteOutOf.apply(s,i)})}}),T["\\"]=q($,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[b].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[b].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[b].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?P(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||t.parent.write(t,e))},this.ends[b].keystroke=function(t,n,s){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(s.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return v(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[b].latex()+" "},t.renderCommand=function(t){var e,n;this.jQ=this.jQ.last(),this.remove(),this[x]?t.insLeftOf(this[x]):t.insAtRightEnd(this.parent),e=this.ends[b].latex(),e||(e=" "),n=O[e]||se[e],n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):(n=H(),n.replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}),oe=c(1);for(le in oe)!function(t,e){"function"==typeof e?(l[t]=function(){return o(),e.apply(this,arguments)},l[t].prototype=e.prototype):l[t]=e}(le,oe[le]);"object"==typeof module&&"object"==typeof module.exports&&(module.exports=l)}();
